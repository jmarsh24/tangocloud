<%# locals(recording:) %>
<% cache(recording) do %>
  <div class="flex flex-1 gap-2 items-center">
    <%= image_tag recording.digital_remasters.first.album.album_art, class: "h-20 aspect-square object-cover" %>
    <div class="flex flex-1 flex-col items-start text-left p-1 relative">
      <div class="text-sm font-semibold truncate" title="<%= recording.composition.title %>">
        <%= recording.composition.title %>
      </div>
      <div class="text-xs text-gray-500 truncate" title="<%= recording.orchestra.name %><% if recording.singers.present? %> - <%= recording.singers.map(&:name).join(', ') %><% end %>">
        <%= recording.orchestra.name %>
        <% if recording.singers.present? %>
          &middot; <%= recording.singers.map(&:name).join(", ") %>
        <% end %>
      </div>
      <div class="text-xs text-gray-500 truncate" title="<%= recording.genre.name %> - <%= recording.year %>">
        <%= recording.genre.name %> - <%= recording.year %>
      </div>
      <div class="absolute bottom-0 right-2 flex justify-end">
        <% popularity_level = (recording.popularity_score / 16.67).ceil %>
        <svg width="30" height="10" aria-label="Popularity" class="text-neutral-500">
          <% 6.times do |i| %>
            <rect 
              x="<%= i * 5 %>" 
              y="0" 
              width="2" 
              height="7" 
              class="<%= i < popularity_level ? 'fill-current text-neutral-400' : 'fill-current text-neutral-600' %>">
            </rect>
          <% end %>
        </svg>
      </div>
    </div>
  </div>
<% end %>