<%# locals(recording:) %>
<% cache(recording) do %>
  <div class="flex flex-auto gap-4 items-center overflow-hidden relative py-4 px-2">
    <div class="absolute top-2 right-2 text-xs font-semibold text-neutral-500">
      <%= recording.year %>
    </div>
    <div class="h-16 w-16 flex items-center justify-center relative rounded-full overflow-hidden border border-neutral-800">
      <div class="h-8 w-8 z-50 font-bold text-md flex items-center justify-center rounded-full text-white"
           style="background-color: <%= genre_color(recording.genre.name) %>;">
        <%= recording.genre.name[0].upcase %>
      </div>
      <%= image_tag recording.digital_remasters.first.album.album_art, class: "absolute inset-0 w-full h-full object-cover rounded-full" %>
    </div>
    <div class="flex flex-auto flex-col items-start text-left overflow-hidden">
      <div class="text-sm font-semibold text-nowrap" title="<%= recording.composition.title %>">
        <%= recording.composition.title %>
      </div>
      <div class="text-xs text-neutral-500 text-nowrap" title="<%= recording.orchestra.name %><% if recording.singers.present? %> - <%= recording.singers.map(&:name).join(', ') %><% end %>">
        <%= recording.orchestra.display_name %>
      </div>
      <% if recording.singers.present? %>
        <div class="text-xs text-neutral-500 text-nowrap" title="<% if recording.singers.present? %> - <%= recording.singers.map(&:name).join(', ') %><% end %>">
          <%= recording.singers.map(&:display_name).join(", ") %>
        </div>
      <% end %>
    </div>
    <div class="absolute bottom-2 right-2 flex justify-end">
      <% popularity_level = (recording.popularity_score / 16.67).ceil %>
      <svg width="30" height="10" aria-label="Popularity" class="text-neutral-500">
        <% 6.times do |i| %>
          <rect 
          x="<%= i * 5 %>" 
          y="0" 
          width="2" 
          height="7" 
          class="<%= i < popularity_level ? 'fill-current text-neutral-400' : 'fill-current text-neutral-600' %>">
          </rect>
        <% end %>
      </svg>
    </div>
  </div>
<% end %>